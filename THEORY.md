# Научно-теоретическая часть — Модель Black-Scholes

## 3.1 Задача

Рассчитать справедливую (теоретическую) цену европейского опциона Call/Put и рассчитать греческие показатели: Delta, Gamma, Vega, Theta.

## 3.2 Модель

Используется модель Black–Scholes (1973) для европейских опционов на бездивидендный базовый актив.

### Основные формулы

**Промежуточные переменные:**
```
d₁ = [ln(S/K) + (r + ½σ²)T] / (σ√T)
d₂ = d₁ - σ√T
```

**Цена call-опциона:**
```
C = S·Φ(d₁) - K·e^(-rT)·Φ(d₂)
```

**Цена put-опциона:**
```
P = K·e^(-rT)·Φ(-d₂) - S·Φ(-d₁)
```

**Греческие показатели:**

**Delta:**
```
Δ_call = Φ(d₁)
Δ_put = Φ(d₁) - 1
```

**Gamma:**
```
Γ = φ(d₁) / (S·σ·√T)
```

**Vega:**
```
Vega = S·φ(d₁)·√T
```
(в единицах «на 1.0 = 100%»)

**Theta (в год):**
```
Θ_call = -S·φ(d₁)·σ/(2√T) - r·K·e^(-rT)·Φ(d₂)
Θ_put = -S·φ(d₁)·σ/(2√T) + r·K·e^(-rT)·Φ(-d₂)
```

### Обозначения

- **S** — текущая цена базового актива
- **K** — страйк-цена опциона
- **r** — безрисковая процентная ставка
- **σ** — волатильность базового актива
- **T** — время до экспирации (в годах)
- **Φ(x)** — функция распределения стандартного нормального распределения (CDF)
- **φ(x)** — плотность вероятности стандартного нормального распределения (PDF)

### Примечания по единицам

- В UI волатильность вводится в процентах (например, 20 → 0.20 в формуле)
- В приложении Vega показывается как чувствительность цены опциона к изменению волатильности на 1 процентный пункт (т.е. vega/100)
- Theta отображается как в годовых, так и в дневных единицах

## 3.3 Ограничения модели

1. **Тип опционов**: Модель подходит только для европейских опционов (без дивидендов)
2. **Американские опционы**: Для американских опционов требуется биномиальная модель или finite difference методы
3. **Граничные случаи**: Для кратких времён и нулевой волатильности следует обрабатывать граничные случаи (интринсивная стоимость)
4. **Постоянные параметры**: Модель предполагает постоянство волатильности и безрисковой ставки
5. **Логнормальное распределение**: Предполагается, что доходность актива имеет логнормальное распределение

## 3.4 Реализация в приложении

### Численные методы

1. **Функция ошибки (erf)**: Реализована через приближение с полиномом
2. **CDF нормального распределения**: Вычисляется через erf
3. **PDF нормального распределения**: Стандартная формула

### Обработка граничных случаев

```dart
if (S <= 0 || K <= 0 || sigma <= 0 || T <= 0) {
  final intrinsic = isCall ? max(0.0, S - K) : max(0.0, K - S);
  return BSResult(intrinsic, 0, 0, 0, 0);
}
```

### Точность вычислений

- Используется тип `double` для всех вычислений
- Результаты отображаются с точностью до 2-6 знаков после запятой
- Vega нормализуется для отображения чувствительности на 1%

## 3.5 Тестовые примеры

### Контрольный пример

**Входные данные:**
- S = 100 ₽
- K = 100 ₽  
- r = 0.05
- σ = 20%
- T = 1 год
- Тип = Call

**Ожидаемые результаты:**
- Call price ≈ 10.4505836 ₽
- Delta ≈ 0.63683065
- Gamma ≈ 0.01876202
- Vega ≈ 37.5240 (на 1.0 = 100%-пункт) → Vega на 1% ≈ 0.37524 ₽
- Theta (в год) ≈ -6.4140 ₽/год → Theta ≈ -0.01758 ₽/день

Эти значения можно использовать для проверки корректности реализации модели.
